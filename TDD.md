# TDD.md â€” æŠ€æœ¯è®¾è®¡æ–‡æ¡£

## æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GitHub Pages                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            index.html                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Config â”‚  â”‚ Data     â”‚  â”‚ Binance  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Loader â”‚â†’â”‚ Renderer â”‚â†â”‚ WebSocketâ”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                    â†“                        â”‚    â”‚
â”‚  â”‚         data/latest.json                    â”‚    â”‚
â”‚  â”‚         data/history.json                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      GitHub Actions (every 15 min)         â”‚    â”‚
â”‚  â”‚  fetch_prices.py â†’ data/*.json â†’ commit   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç»„ä»¶è®¾è®¡

### 1. æ•°æ®æŠ“å–è„šæœ¬ (`scripts/fetch_prices.py`)

**èŒè´£ï¼š** ä» Yahoo Finance å’Œ Binance è·å–æœ€æ–°ä»·æ ¼ + 7 å¤©å†å²

**è¾“å…¥ï¼š** `config.json`ï¼ˆå“ç§åˆ—è¡¨ï¼‰

**è¾“å‡ºï¼š**
- `data/latest.json` â€” æ¯ä¸ªå“ç§çš„æœ€æ–°ä»·æ ¼ã€24h å˜åŒ–ã€æ—¶é—´æˆ³
- `data/history.json` â€” æ¯ä¸ªå“ç§çš„ 7 å¤©æ—¥æ”¶ç›˜ä»·åºåˆ—ï¼ˆsparkline ç”¨ï¼‰

**latest.json ç»“æ„ï¼š**
```json
{
  "updated_at": "2026-02-02T21:30:00Z",
  "assets": {
    "GC=F": {
      "price": 2850.30,
      "change_pct": 0.45,
      "prev_close": 2837.52,
      "name": "é»„é‡‘",
      "updated": "2026-02-02T21:30:00Z"
    },
    "BTCUSDT": {
      "price": 98500.00,
      "change_pct": 2.1,
      "prev_close": 96470.59
    }
  }
}
```

**history.json ç»“æ„ï¼š**
```json
{
  "GC=F": {
    "dates": ["2026-01-27", "2026-01-28", ...],
    "prices": [2810.5, 2825.3, ...]
  }
}
```

**ä¾èµ–ï¼š** yfinance, requests
**é”™è¯¯å¤„ç†ï¼š** æ¯ä¸ªå“ç§ç‹¬ç«‹ try-exceptï¼Œå¤±è´¥æ ‡è®° `"error": true`ï¼Œä¸å½±å“å…¶ä»–å“ç§
**è¶…æ—¶ï¼š** æ‰€æœ‰ç½‘ç»œè¯·æ±‚ 10 ç§’è¶…æ—¶

### 2. å‰ç«¯ (`index.html`)

**å•æ–‡ä»¶æ¶æ„ï¼š** HTML + å†…åµŒ CSS + å†…åµŒ JSï¼ˆæ— æ„å»ºå·¥å…·ï¼‰

**æ•°æ®æµï¼š**
1. é¡µé¢åŠ è½½ â†’ fetch `config.json` + `data/latest.json` + `data/history.json`
2. æ¸²æŸ“æ‰€æœ‰å¡ç‰‡ï¼ˆæŒ‰ category åˆ†ç»„ï¼‰
3. å¯¹ source=binance çš„å“ç§ï¼Œå»ºç«‹ WebSocket è¿æ¥å®æ—¶æ›´æ–°
4. æ¯ 30 ç§’é‡æ–° fetch `data/latest.json` æ›´æ–°é crypto æ•°æ®

**å¡ç‰‡ç»„ä»¶ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¥‡ é»„é‡‘          USD/oz â”‚
â”‚                          â”‚
â”‚      $2,850.30           â”‚  â† å¤§å­—ä»·æ ¼
â”‚      +0.45%              â”‚  â† ç»¿è‰²æ¶¨/çº¢è‰²è·Œ
â”‚  â•±â•²â•±â•²â•±â•²â•±â•²â”€â”€â”€           â”‚  â† sparkline canvas
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Sparkline å®ç°ï¼š**
- HTML5 Canvasï¼Œ70Ã—30 åƒç´ 
- 7 å¤©æ”¶ç›˜ä»·ï¼Œå½’ä¸€åŒ–åç»˜åˆ¶æŠ˜çº¿
- æ¶¨ï¼ˆæœ€åä»· > ç¬¬ä¸€ä»·ï¼‰ç”¨ emerald-400ï¼Œè·Œç”¨ red-400

**Binance WebSocketï¼š**
- è¿æ¥ `wss://stream.binance.com:9443/ws`
- è®¢é˜… `{symbol}@ticker` stream
- å®æ—¶æ›´æ–°ä»·æ ¼å’Œæ¶¨è·Œå¹…
- è‡ªåŠ¨é‡è¿ï¼ˆæ–­çº¿ 3 ç§’åé‡è¯•ï¼‰

### 3. GitHub Actions (`.github/workflows/update-prices.yml`)

**è§¦å‘ï¼š**
- Schedule: `*/15 * * * *`ï¼ˆæ¯ 15 åˆ†é’Ÿï¼‰
- workflow_dispatchï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰

**æ­¥éª¤ï¼š**
1. Checkout repo
2. Setup Python 3.11
3. `pip install yfinance requests`
4. `python scripts/fetch_prices.py`
5. æ£€æŸ¥ data/ æ˜¯å¦æœ‰å˜åŒ–
6. å¦‚æœ‰å˜åŒ–ï¼Œcommit + push

**æ³¨æ„ï¼š** åª commit `data/` ç›®å½•ï¼Œä¸è§¦å‘å¾ªç¯

## æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | é€‰æ‹© | ç†ç”± |
|------|------|------|
| å‰ç«¯æ¡†æ¶ | æ— ï¼ˆåŸç”Ÿ JSï¼‰ | å•é¡µç®€å•åº”ç”¨ï¼Œæ— éœ€æ¡†æ¶ |
| å›¾è¡¨ | Canvas API | sparkline æç®€ï¼Œä¸éœ€è¦ Chart.js |
| Crypto æ•°æ® | Binance WebSocket | å…è´¹ã€CORS å‹å¥½ã€çœŸå®æ—¶ |
| é Crypto æ•°æ® | yfinance + GitHub Actions | å¯é ã€å…è´¹ã€æ—  CORS é—®é¢˜ |
| éƒ¨ç½² | GitHub Pages | é›¶æˆæœ¬ã€è‡ªåŠ¨éƒ¨ç½² |
| å­—ä½“ | Inter (Google Fonts) | ä¸ Guru Tracker ä¸€è‡´ |

## æ–‡ä»¶ç»“æ„
```
market-dashboard/
â”œâ”€â”€ index.html              # ä¸»é¡µé¢ï¼ˆå•æ–‡ä»¶ï¼‰
â”œâ”€â”€ config.json             # å“ç§é…ç½®
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ latest.json         # æœ€æ–°ä»·æ ¼ï¼ˆActions æ›´æ–°ï¼‰
â”‚   â””â”€â”€ history.json        # 7 å¤©å†å²ï¼ˆActions æ›´æ–°ï¼‰
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ fetch_prices.py     # ä»·æ ¼æŠ“å–è„šæœ¬
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ update-prices.yml
â”œâ”€â”€ REQUIREMENTS.md
â”œâ”€â”€ TDD.md
â”œâ”€â”€ TESTING.md
â”œâ”€â”€ CLAUDE.md
â””â”€â”€ README.md
```

## å·²çŸ¥é™åˆ¶
- é• (^SPGSNI) åœ¨ yfinance ä¸Šå¯èƒ½ä¸å¯ç”¨ï¼Œéœ€æµ‹è¯•å¹¶å‡†å¤‡ fallback (NI=F æˆ– LME Nickel ETF)
- ç¨€åœŸæ— æœŸè´§åˆçº¦ï¼Œç”¨ REMX ETF ä½œä»£ç†
- é crypto æ•°æ®å»¶è¿Ÿæœ€å¤š 15 åˆ†é’Ÿ
- Binance WebSocket åœ¨æŸäº›ç½‘ç»œç¯å¢ƒå¯èƒ½è¢«é˜»æ–­ï¼Œå‰ç«¯éœ€æ˜¾ç¤º fallback é™æ€ä»·æ ¼
